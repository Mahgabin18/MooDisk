{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\acer\\\\Desktop\\\\cap_music\\\\client\\\\src\\\\Spotistuff\\\\Details.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, memo, useRef } from 'react';\nimport '../Css/Details.css';\nimport axios from 'axios';\nimport Script from 'react-load-script';\nimport { detect } from 'detect-browser';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst browser = detect();\n\nconst Details = /*#__PURE__*/_s( /*#__PURE__*/memo(_c = _s(props => {\n  _s();\n\n  //console.log(\"Details Component\");\n  const [player, setPlayer] = useState();\n  const duration = useRef();\n  const device = useRef();\n\n  window.onSpotifyWebPlaybackSDKReady = () => {\n    setPlayer(new window.Spotify.Player({\n      // Spotify is not defined until\n      name: 'Spotify Web Player',\n      // the script is loaded in\n      getOAuthToken: cb => {\n        cb(props.access_token);\n      }\n    }));\n  };\n\n  const request = device => {\n    axios(`https://api.spotify.com/v1/me/player/play?device_id=${device}`, {\n      method: 'PUT',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': 'Bearer ' + props.access_token\n      },\n      data: {\n        \"context_uri\": \"spotify:playlist:\" + [props.playlistTrack.current],\n        \"offset\": {\n          \"uri\": \"spotify:track:\" + props.tracks.selectedTrack.id\n        }\n      }\n    });\n  };\n\n  useEffect(() => {\n    if (player && browser.name !== 'safari') {\n      player.on('player_state_changed', state => {\n        if (state) {\n          duration.current = state.duration;\n        }\n      });\n      player.connect();\n      player.getCurrentState().then(state => {\n        if (state) {\n          if (state.track_window.current_track.name !== props.tracks.selectedTrack.name || state.track_window.current_track.artists[0].name !== props.tracks.selectedTrack.artists[0].name) {\n            request(device.current);\n          }\n        }\n      });\n      player.addListener('ready', _ref => {\n        let {\n          device_id\n        } = _ref;\n        device.current = device_id;\n        request(device_id);\n      });\n      const interval = setInterval(() => {\n        player.getCurrentState().then(state => {\n          if (state) {\n            if (state.track_window.current_track.name !== props.tracks.selectedTrack.name || state.track_window.current_track.artists[0].name !== props.tracks.selectedTrack.artists[0].name) {\n              props.setTracks({\n                selectedTrack: state.track_window.current_track,\n                listOfTracksFromApi: props.tracks.listOfTracksFromApi\n              });\n            } //console.log(\"Check state\")\n\n\n            document.getElementById(\"seekbar\").value = state.position / state.duration;\n          }\n        });\n      }, 1000);\n      return () => clearInterval(interval);\n    }\n  });\n\n  const compute = _ => {\n    let count = 0;\n\n    for (const elem of props.tracks.listOfTracksFromApi.entries()) {\n      if (props.tracks.selectedTrack.id === elem[1].track.id) {\n        return count;\n      }\n\n      count++;\n    }\n\n    return -1;\n  };\n\n  const onPrevClick = _ => {\n    if (props.tracks.listOfTracksFromApi[0].track.name === props.tracks.selectedTrack.name) {\n      player.seek(0);\n    } else {\n      let index = compute();\n\n      if (index > -1) {\n        props.setTracks({\n          selectedTrack: props.tracks.listOfTracksFromApi[index - 1].track,\n          listOfTracksFromApi: props.tracks.listOfTracksFromApi\n        });\n      } else {\n        player.previousTrack();\n      }\n    }\n  };\n\n  const onPlayClick = _ => {\n    if (props.playing) props.setPlaying(false);else props.setPlaying(true);\n    player.togglePlay();\n  };\n\n  const onNextClick = _ => {\n    let index = compute();\n\n    if (props.tracks.listOfTracksFromApi[props.tracks.listOfTracksFromApi.length - 1].track.id === props.tracks.selectedTrack.id || index === -1) {\n      player.nextTrack();\n    } else {\n      props.setTracks({\n        selectedTrack: props.tracks.listOfTracksFromApi[index + 1].track,\n        listOfTracksFromApi: props.tracks.listOfTracksFromApi\n      });\n    }\n  };\n\n  const position = e => {\n    player.seek(duration.current * e.target.value);\n  };\n\n  const volume = e => {\n    axios('https://api.spotify.com/v1/me/player/volume?volume_percent=' + Math.round(e.target.value * 100), {\n      method: 'PUT',\n      headers: {\n        'Authorization': 'Bearer ' + props.access_token\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"SongDetails\",\n    children: [/*#__PURE__*/_jsxDEV(Script, {\n      url: \"https://sdk.scdn.co/spotify-player.js\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"link\", {\n      rel: \"stylesheet\",\n      href: \"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n      className: \"Image\",\n      src: props.tracks.selectedTrack.album.images[0].url,\n      alt: props.tracks.selectedTrack.artists[0]\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"Name\",\n        children: props.tracks.selectedTrack.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"Artist\",\n        children: props.tracks.selectedTrack.artists[0].name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"range\",\n        className: \"Seekbar\",\n        id: \"seekbar\",\n        min: \"0\",\n        max: \"1\",\n        step: \"0.001\",\n        defaultValue: \"0\",\n        onChange: position\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 12\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"Toggle\",\n      onClick: onPrevClick,\n      children: /*#__PURE__*/_jsxDEV(\"i\", {\n        className: \"fa fa-backward\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 56\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"Pause\",\n      id: \"Pause\",\n      onClick: onPlayClick,\n      children: props.playing ? /*#__PURE__*/_jsxDEV(\"i\", {\n        className: \"fa fa-pause\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 83\n      }, this) : /*#__PURE__*/_jsxDEV(\"i\", {\n        className: \"fa fa-play\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 116\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"Toggle\",\n      onClick: onNextClick,\n      children: /*#__PURE__*/_jsxDEV(\"i\", {\n        className: \"fa fa-forward\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 56\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Volume\",\n      children: [/*#__PURE__*/_jsxDEV(\"i\", {\n        className: \"fa fa-volume-up\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 31\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"range\",\n        min: \"0\",\n        max: \"1\",\n        step: \"0.05\",\n        defaultValue: \"1\",\n        onChange: volume\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 66\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 5\n  }, this);\n}, \"yHvfzWVeZ1fL6BtC8oFd8ANOc08=\")), \"yHvfzWVeZ1fL6BtC8oFd8ANOc08=\");\n\n_c2 = Details;\nexport default Details;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Details$memo\");\n$RefreshReg$(_c2, \"Details\");","map":{"version":3,"sources":["C:/Users/acer/Desktop/cap_music/client/src/Spotistuff/Details.js"],"names":["React","useState","useEffect","memo","useRef","axios","Script","detect","browser","Details","props","player","setPlayer","duration","device","window","onSpotifyWebPlaybackSDKReady","Spotify","Player","name","getOAuthToken","cb","access_token","request","method","headers","data","playlistTrack","current","tracks","selectedTrack","id","on","state","connect","getCurrentState","then","track_window","current_track","artists","addListener","device_id","interval","setInterval","setTracks","listOfTracksFromApi","document","getElementById","value","position","clearInterval","compute","_","count","elem","entries","track","onPrevClick","seek","index","previousTrack","onPlayClick","playing","setPlaying","togglePlay","onNextClick","length","nextTrack","e","target","volume","Math","round","album","images","url"],"mappings":"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","sourcesContent":["import React, {useState, useEffect, memo, useRef} from 'react';\r\nimport '../Css/Details.css';\r\nimport axios from 'axios';\r\nimport Script from 'react-load-script';\r\nimport {detect} from 'detect-browser';\r\nconst browser=detect();\r\n\r\nconst Details = memo(props => {\r\n  //console.log(\"Details Component\");\r\n  const [player, setPlayer]=useState();\r\n  const duration = useRef();\r\n  const device=useRef();\r\n\r\n  window.onSpotifyWebPlaybackSDKReady = () => {\r\n    setPlayer(new window.Spotify.Player({      // Spotify is not defined until\r\n      name: 'Spotify Web Player',            // the script is loaded in\r\n      getOAuthToken: cb => {cb(props.access_token)}\r\n    }))\r\n  }\r\n\r\n  const request=device=>{\r\n    axios(`https://api.spotify.com/v1/me/player/play?device_id=${device}`, {\r\n      method: 'PUT',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': 'Bearer ' + props.access_token\r\n      },\r\n      data: {\"context_uri\": \"spotify:playlist:\"+[props.playlistTrack.current], \"offset\": {\"uri\": \"spotify:track:\"+props.tracks.selectedTrack.id}}\r\n    })\r\n  }\r\n\r\n  useEffect(()=>{\r\n    if(player && browser.name!=='safari'){\r\n      player.on('player_state_changed', state => {\r\n        if(state){\r\n          duration.current=state.duration;\r\n        }\r\n      });\r\n      player.connect();\r\n      player.getCurrentState().then(state => {\r\n        if(state) {\r\n          if(state.track_window.current_track.name!==props.tracks.selectedTrack.name || state.track_window.current_track.artists[0].name!==props.tracks.selectedTrack.artists[0].name){\r\n            request(device.current)\r\n          }\r\n        }\r\n      });\r\n      player.addListener('ready',({device_id})=>{\r\n        device.current=device_id;\r\n        request(device_id);\r\n      })\r\n      const interval = setInterval(() => {\r\n        player.getCurrentState().then(state => {\r\n          if(state){\r\n            if(state.track_window.current_track.name!==props.tracks.selectedTrack.name || state.track_window.current_track.artists[0].name!==props.tracks.selectedTrack.artists[0].name){\r\n              props.setTracks({selectedTrack: state.track_window.current_track, listOfTracksFromApi: props.tracks.listOfTracksFromApi});\r\n            }\r\n            //console.log(\"Check state\")\r\n            document.getElementById(\"seekbar\").value= state.position/state.duration;\r\n          }\r\n        })\r\n      }, 1000);\r\n      return () => clearInterval(interval);\r\n    }\r\n  })\r\n\r\n  const compute = _ =>{\r\n    let count=0;\r\n    for(const elem of props.tracks.listOfTracksFromApi.entries()){\r\n      if(props.tracks.selectedTrack.id===elem[1].track.id){\r\n        return count;\r\n      }\r\n      count++;\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  const onPrevClick= _=>{\r\n    if(props.tracks.listOfTracksFromApi[0].track.name===props.tracks.selectedTrack.name){\r\n      player.seek(0);\r\n    }\r\n    else{\r\n      let index=compute();\r\n      if (index>-1){\r\n        props.setTracks({selectedTrack: props.tracks.listOfTracksFromApi[index-1].track, listOfTracksFromApi: props.tracks.listOfTracksFromApi});\r\n      }\r\n      else{\r\n        player.previousTrack();\r\n      }\r\n    }\r\n  };\r\n\r\n  const onPlayClick=_=>{\r\n    if(props.playing)\r\n      props.setPlaying(false);\r\n    else\r\n      props.setPlaying(true);\r\n    player.togglePlay();\r\n  };\r\n\r\n  const onNextClick = _=>{\r\n    let index=compute();\r\n    if(props.tracks.listOfTracksFromApi[props.tracks.listOfTracksFromApi.length-1].track.id===props.tracks.selectedTrack.id || index===-1){\r\n      player.nextTrack();\r\n    }\r\n    else{\r\n      props.setTracks({selectedTrack: props.tracks.listOfTracksFromApi[index+1].track, listOfTracksFromApi: props.tracks.listOfTracksFromApi});\r\n    }\r\n  };\r\n\r\n  const position=e=>{\r\n    player.seek(duration.current*e.target.value);\r\n  }\r\n\r\n  const volume=e=>{\r\n    axios('https://api.spotify.com/v1/me/player/volume?volume_percent='+Math.round(e.target.value*100), {\r\n      method: 'PUT',\r\n      headers: {'Authorization' : 'Bearer ' + props.access_token}\r\n    })\r\n  }\r\n\r\n  return (\r\n    <div className=\"SongDetails\">\r\n      <Script url=\"https://sdk.scdn.co/spotify-player.js\"/>\r\n      <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css\"/ >\r\n      <img className=\"Image\" src = {props.tracks.selectedTrack.album.images[0].url} alt = {props.tracks.selectedTrack.artists[0]}></img>\r\n      <div>\r\n        <label className=\"Name\">{props.tracks.selectedTrack.name}</label>\r\n      </div>\r\n      <div>\r\n        <label className=\"Artist\">{props.tracks.selectedTrack.artists[0].name}</label>\r\n      </div>\r\n      <div><input type=\"range\" className=\"Seekbar\" id=\"seekbar\" min=\"0\" max=\"1\" step=\"0.001\" defaultValue=\"0\" onChange={position}/></div>\r\n      <button className=\"Toggle\" onClick={onPrevClick}><i className=\"fa fa-backward\"></i></button>\r\n      <button className=\"Pause\" id=\"Pause\" onClick={onPlayClick}>{props.playing ? <i className=\"fa fa-pause\"></i>: <i className=\"fa fa-play\"></i>}</button>\r\n      <button className=\"Toggle\" onClick={onNextClick}><i className=\"fa fa-forward\"></i></button>\r\n      <div className=\"Volume\"><i className=\"fa fa-volume-up\"></i><input type=\"range\" min=\"0\" max=\"1\" step=\"0.05\" defaultValue=\"1\" onChange={volume}/></div>\r\n    </div>\r\n  );\r\n})\r\n\r\nexport default Details;\r\n"]},"metadata":{},"sourceType":"module"}